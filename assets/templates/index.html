<!doctype html>
<title>Crowdsourced Random Number</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" href="/static/style.css" />

<script src="https://unpkg.com/htmx.org@2.0.1/dist/htmx.js"></script>
<script src="https://unpkg.com/htmx-ext-ws@2.0.1/ws.js"></script>
<script src="https://unpkg.com/htmx-ext-json-enc@2.0.1/json-enc.js"></script>

<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  href="https://fonts.googleapis.com/css2?family=Dosis:wght@200..800&display=swap"
  rel="stylesheet"
/>

<h1>Natural Random Numbers</h1>

<main>
  <form
    id="entry-form"
    hx-post="api/submit_random"
    hx-ext="json-enc"
    hx-swap="none"
  >
    <input name="random_number" type="number" />
    <button type="submit">Send random number</button>
  </form>

  <p><code>curl {{ host }}/api/get_random</code> for a random number.</p>

  <div id="waitlist" hx-ext="ws" ws-connect="/ws">
    {% block list %}
      <div id="list" hx-swap-oob="outerHTML">
        <p>
          {% if pending_requests.is_empty() %}
            Nobody needs a number right now!
          {% else %}
            Clients waiting for a number:
          {% endif %}
        </p>

        {% for client in pending_requests %}
          <li>{{ client }}</li>
        {% endfor %}
      </div>
    {% endblock %}
  </div>
</main>
